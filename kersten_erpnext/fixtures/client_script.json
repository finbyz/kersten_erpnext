[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Item",
  "enabled": 1,
  "modified": "2020-10-15 13:49:07.918548",
  "name": "Item-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on(\"Web Page Block\", {\n\tedit_values(frm, cdt, cdn) {\n\t\tlet row = frm.selected_doc;\n\t\tfrappe.model.with_doc(\"Web Template\", row.web_template).then((doc) => {\n    \t\tlet d = new frappe.ui.Dialog({\n    \t\t\ttitle: __(\"Edit Values\"),\n    \t\t\tfields: doc.fields.map((df) => {\n    \t\t\t\tif (df.fieldtype == \"Section Break\") {\n    \t\t\t\t\tdf.collapsible = 1;\n    \t\t\t\t}\n    \t\t\t\treturn df;\n    \t\t\t}),\n    \t\t\tprimary_action(values) {\n    \t\t\t\tfrappe.model.set_value(\n    \t\t\t\t\tcdt,\n    \t\t\t\t\tcdn,\n    \t\t\t\t\t\"web_template_values\",\n    \t\t\t\t\tJSON.stringify(values)\n    \t\t\t\t);\n    \t\t\t\td.hide();\n    \t\t\t},\n    \t\t});\n    \t\tlet values = JSON.parse(row.web_template_values || \"{}\");\n    \t\td.set_values(values);\n    \t\td.show();\n    \n    \t\td.sections.forEach((sect) => {\n    \t\t\tlet fields_with_value = sect.fields_list.filter(\n    \t\t\t\t(field) => values[field.df.fieldname]\n    \t\t\t);\n    \n    \t\t\tif (fields_with_value.length) {\n    \t\t\t\tsect.collapse(false);\n    \t\t\t}\n    \t\t});\n\t    });\n\t},\n\t\n\tcopy_from_doctype(frm, cdt, cdn) {\n\t\tlet row = frm.selected_doc;\n\t\tfrappe.model.with_doc(\"Web Template\", row.web_template).then((doc) => {\n\t\t\tlet d = new frappe.ui.Dialog({\n\t\t\t\ttitle: __(\"Copy from Testimonial\"),\n\t\t\t\tfields: [{\n\t\t\t\t    fieldname: \"docname\", \n\t\t\t\t    label: __('Testimonial'), \n\t\t\t\t    fieldtype:\"Link\", \n\t\t\t\t    options: \"Testimonial\"\n\t\t\t\t}],\n\t\t\t\tprimary_action(values) {\n\t\t\t\t    let testimonial = d.get_value('docname');\n\t\t\t\t    frappe.model.with_doc(\"Testimonial\", testimonial).then((doc) => {\n\t\t\t\t        let values = {\n\t\t\t\t            'logo': doc.image,\n\t\t\t\t            'name': doc.customer_name,\n\t\t\t\t            'content': doc.content,\n\t\t\t\t        };\n\t\t\t\t        \n    \t\t\t\t\tfrappe.model.set_value(\n    \t\t\t\t\t\tcdt,\n    \t\t\t\t\t\tcdn,\n    \t\t\t\t\t\t\"web_template_values\",\n    \t\t\t\t\t\tJSON.stringify(values)\n    \t\t\t\t\t);\n\t\t\t\t    })\n\t\t\t\t\td.hide();\n\t\t\t\t},\n\t\t\t});\n\t\t\tlet values = JSON.parse(row.web_template_values || \"{}\");\n\t\t\td.set_values(values);\n\t\t\td.show();\n\t\t});\n\t},\n\t\n\tcopy_from_item(frm, cdt, cdn) {\n\t\tlet row = frm.selected_doc;\n\t\t\n\t\tfrappe.model.with_doc(\"Web Template\", row.web_template).then((doc) => {\n\t\t    let values = JSON.parse(row.web_template_values || \"{}\");\n\t\t\tlet d = new frappe.ui.Dialog({\n\t\t\t\ttitle: __(\"Copy from Item\"),\n\t\t\t\tfields: [\n\t\t\t\t    {\n    \t\t\t\t    fieldname: \"title\", \n    \t\t\t\t    label: __('Title'), \n    \t\t\t\t    fieldtype:\"Data\", \n\t\t\t\t    },\n\t\t\t\t    {\n    \t\t\t\t    fieldname: \"subtitle\", \n    \t\t\t\t    label: __('Subtitle'), \n    \t\t\t\t    fieldtype:\"Data\", \n\t\t\t\t    },\n\t\t\t\t    {\n    \t\t\t\t    fieldname: \"card_size\", \n    \t\t\t\t    label: __('Card Size'), \n    \t\t\t\t    fieldtype:\"Select\",\n    \t\t\t\t    options: [\"Small\", \"Medium\", \"Large\"]\n\t\t\t\t    },\n\t\t\t\t    {\n    \t\t\t\t    fieldname: \"card_1\", \n    \t\t\t\t    label: __('Item 1'), \n    \t\t\t\t    fieldtype:\"Link\", \n    \t\t\t\t    options: \"Item\",\n    \t\t\t\t    change: () => {\n    \t\t\t\t        let item = d.get_value('card_1')\n    \t\t\t\t        values = get_item_details(item, values, 'card_1');\n    \t\t\t\t    }\n\t\t\t\t        \n\t\t\t\t    },\n\t\t\t\t    {\n    \t\t\t\t    fieldname: \"card_2\", \n    \t\t\t\t    label: __('Item 2'), \n    \t\t\t\t    fieldtype:\"Link\", \n    \t\t\t\t    options: \"Item\",\n    \t\t\t\t    change: () => {\n    \t\t\t\t        let item = d.get_value('card_2')\n    \t\t\t\t        values = get_item_details(item, values, 'card_2');\n    \t\t\t\t    }\n\t\t\t\t        \n\t\t\t\t    },\n\t\t\t\t    {\n    \t\t\t\t    fieldname: \"card_3\", \n    \t\t\t\t    label: __('Item 3'), \n    \t\t\t\t    fieldtype:\"Link\", \n    \t\t\t\t    options: \"Item\",\n    \t\t\t\t    change: () => {\n    \t\t\t\t        let item = d.get_value('card_3')\n    \t\t\t\t        values = get_item_details(item, values, 'card_3');\n    \t\t\t\t    }\n\t\t\t\t        \n\t\t\t\t    },\n\t\t\t\t    {\n    \t\t\t\t    fieldname: \"card_4\", \n    \t\t\t\t    label: __('Item 4'), \n    \t\t\t\t    fieldtype:\"Link\", \n    \t\t\t\t    options: \"Item\",\n    \t\t\t\t    change: () => {\n    \t\t\t\t        let item = d.get_value('card_4')\n    \t\t\t\t        values = get_item_details(item, values, 'card_4');\n    \t\t\t\t    }\n\t\t\t\t        \n\t\t\t\t    },\n\t\t\t\t    {\n    \t\t\t\t    fieldname: \"card_5\", \n    \t\t\t\t    label: __('Item 5'), \n    \t\t\t\t    fieldtype:\"Link\", \n    \t\t\t\t    options: \"Item\",\n    \t\t\t\t    change: () => {\n    \t\t\t\t        let item = d.get_value('card_5')\n    \t\t\t\t        values = get_item_details(item, values, 'card_5');\n    \t\t\t\t    }\n\t\t\t\t        \n\t\t\t\t    },\n\t\t\t\t    {\n    \t\t\t\t    fieldname: \"card_6\", \n    \t\t\t\t    label: __('Item 6'), \n    \t\t\t\t    fieldtype:\"Link\", \n    \t\t\t\t    options: \"Item\",\n    \t\t\t\t    change: () => {\n    \t\t\t\t        let item = d.get_value('card_6')\n    \t\t\t\t        values = get_item_details(item, values, 'card_6');\n    \t\t\t\t    }\n\t\t\t\t        \n\t\t\t\t    },\n\t\t\t\t    {\n    \t\t\t\t    fieldname: \"card_7\", \n    \t\t\t\t    label: __('Item 7'), \n    \t\t\t\t    fieldtype:\"Link\", \n    \t\t\t\t    options: \"Item\",\n    \t\t\t\t    change: () => {\n    \t\t\t\t        let item = d.get_value('card_7')\n    \t\t\t\t        values = get_item_details(item, values, 'card_7');\n    \t\t\t\t    }\n\t\t\t\t        \n\t\t\t\t    },\n\t\t\t\t    {\n    \t\t\t\t    fieldname: \"card_8\", \n    \t\t\t\t    label: __('Item 8'), \n    \t\t\t\t    fieldtype:\"Link\", \n    \t\t\t\t    options: \"Item\",\n    \t\t\t\t    change: () => {\n    \t\t\t\t        let item = d.get_value('card_8')\n    \t\t\t\t        values = get_item_details(item, values, 'card_8');\n    \t\t\t\t    }\n\t\t\t\t        \n\t\t\t\t    },\n\t\t\t\t    {\n    \t\t\t\t    fieldname: \"card_9\", \n    \t\t\t\t    label: __('Item 9'), \n    \t\t\t\t    fieldtype:\"Link\", \n    \t\t\t\t    options: \"Item\",\n    \t\t\t\t    change: () => {\n    \t\t\t\t        let item = d.get_value('card_9')\n    \t\t\t\t        values = get_item_details(item, values, 'card_9');\n    \t\t\t\t    }\n\t\t\t\t        \n\t\t\t\t    }\n\t\t\t\t    \n\t\t\t\t    ],\n\t\t\t\tprimary_action(section_values) {\n\t\t\t\t    values['title'] = section_values['title'];\n\t\t\t\t    values['subtitle'] = section_values['subtitle'];\n\t\t\t\t    values['card_size'] = section_values['card_size'];\n\t\t\t\t    \n\t\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\t\tcdt,\n\t\t\t\t\t\tcdn,\n\t\t\t\t\t\t\"web_template_values\",\n\t\t\t\t\t\tJSON.stringify(values)\n\t\t\t\t\t);\n\t\t\t\t    d.hide();\n\t\t\t\t},\n\t\t\t});\n\t\t\td.set_values(values);\n\t\t\td.show();\n\t\t});\n\t}\n});\n\nfunction get_item_details(item, values, field) {\n    frappe.db.get_value(\"Item\", item, ['thumbnail', 'route'], function(r) {\n        values[field] = item;\n        values[field+'_title'] = item;\n        values[field+'_url'] = r.route;\n        values[field+'_content'] = '<img src=\"'+ r.thumbnail + '\">';\n    })\n    \n    return values;\n}"
 }
]
